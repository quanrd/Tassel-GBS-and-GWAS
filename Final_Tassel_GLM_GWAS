#!/bin/bash

#Identification of QTL associated with trait of interests
#Denpendencies: Tassel
#Here I will use VCF file already generated by Tassel pipeline or samtools or GATK
# Phenotype with associated score file

TASSEL_dir=/shared_resources/shamim_share/Tassel
VCF_dir="/shared_resources/shamim_share/Variant_Calling/Identified_SNPs.vcf"
TRAITS_dir="/shared_resources/shamim_share/Variant_Calling//phenotype_traits.txt"


#sorting vcf files
${TASSEL_dir}/run_pipeline.pl -SortGenotypeFilePlugin -inputFile ${VCF_dir} -outputFile ${VCF_dir%.*}_sorted.vcf
#Performing imputation
${TASSEL_dir}/run_pipeline.pl -fork1 -importGuess ${VCF_dir%.*}_sorted.vcf -ImputationPlugin -ByMean true -nearestNeighbors 5 -distance Euclidean -endPlugin -export ${VCF_dir%.*}_imputed -exportType VCF
# Generate kinship matrix
${TASSEL_dir}/run_pipeline.pl -fork2 -importGuess ${VCF_dir%.*}_imputed.vcf -KinshipPlugin -method Centered_IBS -endPlugin -export ${VCF_dir%.*}_kinship.txt -exportType SqrMatrix
# Running Generalized Linear Model (GLM)
${TASSEL_dir}/run_pipeline.pl \
     -fork1 \
         -importGuess ${VCF_dir%.*}_imputed.vcf \
     -fork2 \
         -importGuess ${TRAITS_dir} \
     -fork3 \
         -importGuess ${VCF_dir%.*}_kinship.txt \
     -combine4 \
         -input1 \
         -input2 \
         -input3 \
         -intersect \
         -FixedEffectLMPlugin \
         -maxP 1e-3 -permute true -nperm 1000 -biallelicOnly true \
-endPlugin -export ${VCF_dir%.*}_glm_output
